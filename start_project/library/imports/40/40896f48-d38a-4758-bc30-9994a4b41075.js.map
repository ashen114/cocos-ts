{"version":3,"sources":["assets\\scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Player extends cc.Component {\r\n  ////////// 注入属性 //////////\r\n  @property\r\n  jumpHeight: number = 0; // 主角跳跃高度\r\n\r\n  @property\r\n  jumpDuration: number = 0; // 主角跳跃持续时间\r\n\r\n  @property\r\n  maxMoveSpeed: number = 0; // 最大移动速度\r\n\r\n  @property\r\n  accel: number = 0; // 加速度\r\n\r\n  @property({ type: cc.AudioClip })\r\n  jumpAudio: cc.AudioClip = null; // 跳跃音效资源\r\n\r\n  @property\r\n  squashDuration: number = 0; // 辅助形变动作时间\r\n\r\n  ////////// 默认属性 //////////\r\n  accLeft: boolean = false; // 向左的加速度\r\n  accRight: boolean = false; // 向右的加速度\r\n  xSpeed: number = 0; // 主角当前水平方向的速度\r\n  jumpAction: cc.ActionInterval = null; // 跳跃动作类\r\n\r\n  ////////// 生命周期 //////////\r\n\r\n  onLoad(): void {\r\n    // 初始化跳跃动作\r\n    this.jumpAction = this.setJumpAction();\r\n    this.node.runAction(this.jumpAction);\r\n\r\n    // 加速度方向开关\r\n    this.accLeft = false;\r\n    this.accRight = false;\r\n\r\n    // 主角当前水平方向速度\r\n    this.xSpeed = 0;\r\n\r\n    // 初始化键盘键入监听\r\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n    // 初始化触屏输入监听\r\n    let touchReceiver: cc.Node = cc.Canvas.instance.node;\r\n    touchReceiver.on(\"touchstart\", this.onTouchStart, this);\r\n    touchReceiver.on(\"touchend\", this.onTouchEnd, this);\r\n  }\r\n\r\n  start(): void {}\r\n\r\n  update(dt: number) {\r\n    // 根据当前加速度方向每帧更新速度\r\n    if (this.accLeft) {\r\n      this.xSpeed -= this.accel * dt;\r\n    } else if (this.accRight) {\r\n      this.xSpeed += this.accel * dt;\r\n    }\r\n\r\n    // 限制主角的速度不能超过最大值\r\n    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\r\n      this.xSpeed = (this.maxMoveSpeed * this.xSpeed) / Math.abs(this.xSpeed);\r\n    }\r\n\r\n    // 根据当前速度更新主角的位置\r\n    this.node.x += this.xSpeed * dt;\r\n  }\r\n\r\n  onDestroy(): void {\r\n    // 取消键盘输入监听\r\n    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n    // 取消触屏输入监听\r\n    let touchReceiver: cc.Node = cc.Canvas.instance.node;\r\n    touchReceiver.off(\"touchstart\", this.onTouchStart, this);\r\n    touchReceiver.off(\"touchend\", this.onTouchEnd, this);\r\n  }\r\n\r\n  ////////// 功能函数 //////////\r\n\r\n  /**\r\n   * 设置跳跃\r\n   */\r\n  setJumpAction(): cc.ActionInterval {\r\n    // 跳跃上升\r\n    let jumpUp: cc.ActionInstant = cc\r\n      .moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight))\r\n      .easing(cc.easeCubicActionOut());\r\n\r\n    // 下落\r\n    let jumpDown: cc.ActionInstant = cc\r\n      .moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight))\r\n      .easing(cc.easeCubicActionIn());\r\n\r\n    // 形变\r\n    let squash: cc.ActionInterval = cc.scaleTo(this.squashDuration, 1, 0.6);\r\n    let stretch: cc.ActionInterval = cc.scaleTo(this.squashDuration, 1, 1.2);\r\n    let scaleBack: cc.ActionInterval = cc.scaleTo(this.squashDuration, 1, 1);\r\n\r\n    // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\r\n    let callback: cc.ActionInstant = cc.callFunc(this.playJumpSound, this);\r\n\r\n    // 不断重复，而且每次完成落地动作后调用回调来播放声音\r\n    return cc.repeatForever(\r\n      cc.sequence(squash, stretch, jumpUp, scaleBack, jumpDown, callback)\r\n    );\r\n  }\r\n\r\n  //---- BEGIN:[输入监听] ----//\r\n  /**\r\n   * 按下键盘\r\n   * @param {cc.Event.EventKeyboard} event 按键事件\r\n   */\r\n  onKeyDown(event: cc.Event.EventKeyboard): void {\r\n    switch (event.keyCode) {\r\n      case cc.macro.KEY.a:\r\n        this.accLeft = true;\r\n        break;\r\n      case cc.macro.KEY.d:\r\n        this.accRight = true;\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 弹起键盘\r\n   * @param {cc.Event.EventKeyboard} event 弹起的按键事件\r\n   */\r\n  onKeyUp(event: cc.Event.EventKeyboard): void {\r\n    switch (event.keyCode) {\r\n      case cc.macro.KEY.a:\r\n        this.accLeft = false;\r\n        break;\r\n      case cc.macro.KEY.d:\r\n        this.accRight = false;\r\n        break;\r\n    }\r\n  }\r\n\r\n  onTouchStart(event: cc.Event.EventTouch) {\r\n    let touchLoc = event.getLocation();\r\n\r\n    if (touchLoc.x >= cc.winSize.width / 2) {\r\n      // 若触屏的 x 大于屏幕宽度的 一半 （右边）\r\n      this.accLeft = false;\r\n      this.accRight = true;\r\n    } else {\r\n      this.accLeft = true;\r\n      this.accRight = false;\r\n    }\r\n  }\r\n\r\n  onTouchEnd(event: cc.Event.EventTouch) {\r\n    this.accLeft = false;\r\n    this.accRight = false;\r\n  }\r\n  //---- END:[输入监听] ----//\r\n\r\n  /**\r\n   * 播放跳跃的声音\r\n   */\r\n  playJumpSound(): void {\r\n    // 调用声音引擎播放声音\r\n    cc.audioEngine.playEffect(this.jumpAudio, false);\r\n  }\r\n}\r\n"]}