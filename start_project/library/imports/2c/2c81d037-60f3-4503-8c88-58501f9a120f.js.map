{"version":3,"sources":["assets\\scripts\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n  ////////// 注入属性 //////////\r\n  @property(cc.Prefab)\r\n  starPrefab: cc.Prefab = null; // 这个属性引用了星星预制资源\r\n\r\n  // 星星产生后消失时间的随机范围\r\n  @property\r\n  maxStarDuration: number = 0;\r\n  @property\r\n  minStarDuration: number = 0;\r\n\r\n  @property(cc.Node)\r\n  ground: cc.Node = null; // 地面节点，用于确定星星生成的高度\r\n\r\n  @property(cc.Node)\r\n  player: cc.Node = null; // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n\r\n  @property(cc.Label)\r\n  scoreDisplay: cc.Label = null; // score Label 的引用\r\n\r\n  @property({ type: cc.AudioClip })\r\n  scoreAudio: cc.AudioClip = null; // 得分音效资源\r\n\r\n  ////////// 默认属性 //////////\r\n  groundY: number = 0; // 地平面的 y 轴坐标\r\n  score: number = 0; // 计分\r\n  timer: number = 0; // 计时器\r\n  starDuration: number = 0; // 星星存活时间\r\n\r\n  ////////// 生命周期 //////////\r\n  onLoad(): void {\r\n    // 获取地平面的 y 轴坐标\r\n    this.groundY = this.ground.y + this.ground.height / 2;\r\n\r\n    // 初始化计时器\r\n    this.timer = 0;\r\n    this.starDuration = 0;\r\n\r\n    // 生成一个新的星星\r\n    this.spawnNewStar();\r\n\r\n    // 初始化计分\r\n    this.score = 0;\r\n  }\r\n\r\n  start(): void {}\r\n\r\n  update(dt: number): void {\r\n    // 每帧更新计时器，超过限度还没生成新的星星\r\n    // 就会调用游戏失败的逻辑\r\n    if (this.timer > this.starDuration) {\r\n      this.gameOver();\r\n      return;\r\n    }\r\n    this.timer += dt;\r\n  }\r\n\r\n  onDestroy(): void {}\r\n\r\n  ////////// 功能函数 //////////\r\n  /**\r\n   * 生成一个新的星星\r\n   */\r\n  spawnNewStar(): void {\r\n    // 使用给定的模板在场景生成一个新的节点\r\n    let newStar: cc.Node = cc.instantiate(this.starPrefab);\r\n\r\n    // 将新增的节点添加到 Canvas 节点下面\r\n    this.node.addChild(newStar);\r\n\r\n    // 为星星设置一个随机的位置\r\n    newStar.setPosition(this.getNewStarPosition());\r\n\r\n    // 在星星组件上暂存 Game 对象的引用\r\n    newStar.getComponent(\"Star\").game = this;\r\n\r\n    // 重置计时器，根据消失时间范围随机取一个值\r\n    this.starDuration =\r\n      this.minStarDuration +\r\n      Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n    this.timer = 0;\r\n  }\r\n\r\n  /**\r\n   * 设置一个随机的位置\r\n   */\r\n  getNewStarPosition(): cc.Vec2 {\r\n    let randX: number = 0;\r\n\r\n    // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\r\n    let randY: number =\r\n      this.groundY +\r\n      Math.random() * this.player.getComponent(\"Player\").jumpHeight +\r\n      50;\r\n\r\n    // 根据屏幕宽度，随机得到一个星星 x 坐标\r\n    let maxX: number = this.node.width / 2;\r\n    randX = (Math.random() - 0.5) * 2 * maxX;\r\n\r\n    // 返回星星坐标\r\n    return cc.v2(randX, randY);\r\n  }\r\n\r\n  /**\r\n   * 计算得分\r\n   */\r\n  gainScore(): void {\r\n    this.score += 1;\r\n\r\n    // 更新scoreDisplay Label 的文字\r\n    this.scoreDisplay.string = \"Score:\" + this.score;\r\n\r\n    // 播放得分音效\r\n    cc.audioEngine.playEffect(this.scoreAudio, false);\r\n  }\r\n\r\n  /**\r\n   * 游戏结束\r\n   */\r\n  gameOver() {\r\n    this.player.stopAllActions(); // 停止 player 节点的跳跃动作\r\n    cc.director.loadScene(\"game\"); // 重新加载 game 场景\r\n  }\r\n}\r\n"]}